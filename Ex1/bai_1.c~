#include <io.h>
#include <delay.h>
#include <glcd.h>
#include <font5x7.h>
#include <dht11.c>

char input_password[5];

void hien_thi() {
    x = dht11(&nhietdo, &doam);
        
    if (x == 1) {
        lcd_gotoxy(0, 0);
        lcd_putsf("TEMP:");
        lcd_putchar(nhietdo / 10 + 48);
        lcd_putchar(nhietdo % 10 + 48);
        lcd_gotoxy(0, 1);
        lcd_putsf("HUMI:");
        lcd_putchar(doam / 10 + 48);
        lcd_putchar(doam % 10 + 48);
    }
}

void BUTTON() {
    int i, j, index = 0;
    while (index < 4) { // Nhap du 4 ki tu
        for (j = 0; j < 3; j++) {
            if (j == 0) PORTF = 0b11111101;
            if (j == 1) PORTF = 0b11110111;
            if (j == 2) PORTF = 0b11011111;
            for (i = 0; i < 3; i++) {
                if ((i == 0 && PINF.2 == 0) ||
                    (i == 1 && PINF.4 == 0) ||
                    (i == 2 && PINF.0 == 0)) {
                    input_password[index] = keypad[i][j] + '0'; // Luu ki tu nhap vao
                    lcd_gotoxy(index, 1);
                    lcd_putchar(input_password[index]);
                    delay_ms(300);
                    lcd_gotoxy(index, 1);
                    lcd_puts("*"); // Hien thi dau *
                    delay_ms(500);
                    index++;
                    break;
                }
            }
        }
    }
    input_password[4] = '\0'; // Ket thuc chuoi
}

void main(){
bool state_1 = true;
int count = 0;
DDRB = 0x00;
PORTB = 0x04;
while(1){
    if(PINB.2 == 0){
            delay_ms(50);
            if(PIB.2 == 0){
                state_1 = !state_1;
            }
        }
    if(state_1 == true){
        hien_thi();
    }else{
        if(count == 0){
            lcd_gotoxy(0, 0);
            lcd_putsf("MIN_TEMP_1:");
            input = read();
            if(input != -1){
                min_temp[input] = true;
                count += 1;
                lcd_gotoxy(0, 0);
                lcd_putsf("MIN_TEMP_1:");
                delay_ms(2000);
            } 
        }else if (count == 1){
            lcd_gotoxy(0, 0);
            lcd_putsf("MIN_TEMP_2:");
            input = read();
            if(input != -1){
                min_temp[input] = true;
                count += 1;
                lcd_gotoxy(0, 0);
                lcd_putsf("MIN_TEMP_2:");
                delay_ms(2000);
            } 
        }
         
    }
}
}

